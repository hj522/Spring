<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace : xml파일은 여러개일 수 있으므로
   이를 구별하기 위한 식별 용도로 사용
 -->
<mapper namespace="hwMember">
	<sql id="where">
		<!-- 통합검색 -->
		AND	(MEM_ID LIKE '%' || #{keyword} || '%' 
	    OR	MEM_NAME LIKE '%' || #{keyword} || '%' 
	    OR	MEM_JOB LIKE '%' || #{keyword} || '%'  
	    OR	MEM_LIKE LIKE '%' || #{keyword} || '%')
	</sql>

	<!-- map: {currentPage=14, keyword=개똥, show=25} -->
	<select id="selectMember" parameterType="hashMap" resultType="HwMemberVO" >
		WITH T AS(
			SELECT ROW_NUMBER() OVER (ORDER BY MEM_ID ASC) RNUM
			        , MEM_ID, MEM_NAME, MEM_JOB, MEM_LIKE, MEM_HP 
			FROM HW_MEMBER
			WHERE 1 = 1
			<if test="keyword!=null and keyword!=''">
				<include refid="where"></include>
			</if>
		)
		SELECT * FROM T
		WHERE T.RNUM BETWEEN #{currentPage} * #{show} - (#{show}-1) AND #{currentPage} * #{show}
<!-- 		SELECT MEM_ID, MEM_NAME, MEM_JOB, MEM_LIKE  -->
<!-- 		FROM HW_MEMBER -->
<!-- 		WHERE 1 = 1 -->
	</select>
	
   <insert id="insertMember" parameterType="HwMemberVO">
   		INSERT INTO HW_MEMBER(MEM_ID, MEM_NAME, MEM_JOB, MEM_LIKE, MEM_HP)
   		VALUES(#{memId}, #{memName}, #{memJob}, #{memLike}, #{memHp})
   </insert>
   
	<!-- HW_MEMBER 전체 행의 수 구하기 -->
	<!-- map: {currentPage=14, keyword=개똥, show=25} -->
   <select id="getTotal" parameterType="hashMap" resultType="int">
   		SELECT COUNT(*) FROM HW_MEMBER
		WHERE 1 = 1
		<if test="keyword!=null and keyword!=''">
			<include refid="where"></include>
		</if>
   </select>
   
   <!-- 아이디 중복 체크 -->
   <!-- parameterType은 String, hashMap, HwMemberVO -->
   <select id="chkDup" parameterType="String" resultType="int">
		SELECT COUNT(*) FROM HW_MEMBER WHERE MEM_ID = #{memId}
   </select>
</mapper>
